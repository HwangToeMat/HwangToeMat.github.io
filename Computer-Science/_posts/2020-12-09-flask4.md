---
title: (웹개발) 04. Flask 다시 배우기 - model, sqlalchemy
image: https://github.com/HwangToeMat/HwangToeMat.github.io/blob/master/Computer-Science/image/WEB/FLASK/flask.png?raw=true
description: >
 Flask를 다시 공부하면서 헷갈리는 부분이나 새로 배운 내용을 정리한다.
author: author1
layout: post
order: 28
---

# [웹개발] 04. Flask 다시 배우기 - model, sqlalchemy

## Flask에서 DB 다루기

### 1. model 설계하기 및 연관관계 설정하기

```python
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

class User(db.Model):
    __tablename__ = 'user'

    id = db.Column(db.Integer, primary_key=True)
    userid = db.Column(db.String(12))
        
class Model_detail(db.Model):
    __tablename__ = 'model_detail'

    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=False) # User 테이블에서 id값을 외래키로 사용
    user = db.relationship('User', backref='model_detail', lazy=True) 
    # backref 를 사용하여 User에서 역참조를 허용(ex.user_1.model_detail)
```

### 2. 데이터베이스 생성하기

1. 기본 설정

- config.py에 설정 추가

```python
SQLALCHEMY_DATABASE_URI = 'sqlite:///XXXX'
SQLALCHEMY_COMMIT_ON_TEARDOWN = True
SQLALCHEMY_TRACK_MODIFICATIONS = False
```

- ORM 적용하기

```python
# __init__.py
from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

db = SQLAlchemy()
migrate = Migrate()

def create_app():
  .....
  db.init_app(app)
  migrate.init_app(app,db)
  .....
  return app
```

- db 초기화 및 모델 변경값 적용하기

```python

# 데이터베이스 초기화
flask db init

# 리비전파일 생성하기
flask db migrate

# 데이터베이스 갱신
flask db upgrade
```

### 3. 데이터 다루기

- 데이터 저장하기

```python
db_1 = User(userid = 'hwangtoemat')
db.session.add(db_1)
db.session.commit(db_1)
```
데이터에 변경사항이 있을 경우 위와같은 과정을 거쳐야 변경사항의 저장이 완료된다.
